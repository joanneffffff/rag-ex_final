# åŸå§‹è¯„ä¼°è„šæœ¬ä½¿ç”¨æŒ‡å—

## ğŸ¯ è„šæœ¬æ¦‚è¿°

**è„šæœ¬åç§°**: `evaluate_encoder_reranker_mrr_rag_system_multi_gpu_fixed.py`  
**ç”¨é€”**: é€šç”¨RAGç³»ç»Ÿè¯„ä¼°  
**ç‰¹ç‚¹**: ä½¿ç”¨çœŸå®RAGç³»ç»Ÿç»„ä»¶ï¼Œæ”¯æŒä¸­è‹±æ–‡æ··åˆæ£€ç´¢  
**é€‚ç”¨**: TAT-QAã€AlphaFinç­‰é€šç”¨æ•°æ®  
**ç‰ˆæœ¬**: v2.0 - çœŸå®RAGç»„ä»¶é›†æˆç‰ˆ  

## ğŸ“‹ æ ¸å¿ƒåŠŸèƒ½

### ğŸ” è¯„ä¼°èƒ½åŠ›
- **çœŸå®RAGç»„ä»¶**: ä½¿ç”¨FinbertEncoderã€BilingualRetrieverã€QwenReranker
- **åŒè¯­è¨€æ”¯æŒ**: æ”¯æŒä¸­è‹±æ–‡æ··åˆæ£€ç´¢å’Œè¯„ä¼°
- **é‡æ’åºä¼˜åŒ–**: ä½¿ç”¨QwenRerankeræå‡æ£€ç´¢ç²¾åº¦
- **MRRè¯„ä¼°**: è®¡ç®—Mean Reciprocal RankæŒ‡æ ‡
- **å¤šGPUæ”¯æŒ**: æ”¯æŒå¤šGPUå¹¶è¡Œå¤„ç†
- **æ‰¹é‡å¤„ç†**: é«˜æ•ˆçš„æ‰¹é‡è¯„ä¼°æœºåˆ¶

### ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
åŸå§‹è¯„ä¼°è„šæœ¬ (çœŸå®RAGç»„ä»¶ç‰ˆ)
â”œâ”€â”€ æ•°æ®åŠ è½½æ¨¡å—
â”‚   â”œâ”€â”€ è¯„ä¼°æ•°æ®åŠ è½½
â”‚   â”œâ”€â”€ æ£€ç´¢åº“æ„å»º (DocumentWithMetadata)
â”‚   â””â”€â”€ æ•°æ®é¢„å¤„ç†
â”œâ”€â”€ RAGç³»ç»Ÿç®¡ç†å™¨
â”‚   â”œâ”€â”€ FinbertEncoder (è‹±æ–‡)
â”‚   â”œâ”€â”€ FinbertEncoder (ä¸­æ–‡)
â”‚   â”œâ”€â”€ BilingualRetriever
â”‚   â”œâ”€â”€ QwenReranker
â”‚   â””â”€â”€ è®¾å¤‡ç®¡ç†
â”œâ”€â”€ æ£€ç´¢å¼•æ“æ¨¡å—
â”‚   â”œâ”€â”€ è¯­ä¹‰æ£€ç´¢ (BilingualRetriever)
â”‚   â”œâ”€â”€ è¯­è¨€æ£€æµ‹å’Œè·¯ç”±
â”‚   â””â”€â”€ æ–‡æ¡£æ’åº
â”œâ”€â”€ é‡æ’åºæ¨¡å—
â”‚   â”œâ”€â”€ å€™é€‰æ–‡æ¡£é‡æ’åº (QwenReranker)
â”‚   â”œâ”€â”€ ç›¸å…³æ€§è¯„åˆ†
â”‚   â””â”€â”€ æœ€ç»ˆæ’åº
â””â”€â”€ è¯„ä¼°åˆ†ææ¨¡å—
    â”œâ”€â”€ MRRè®¡ç®—
    â”œâ”€â”€ æ€§èƒ½ç»Ÿè®¡
    â””â”€â”€ ç»“æœè¾“å‡º
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. åŸºç¡€ä½¿ç”¨ (TAT-QAæ•°æ®)

```bash
# ä½¿ç”¨TAT-QAè¯„ä¼°æ•°æ®
python encoder_finetune_evaluate/evaluate_encoder_reranker_mrr_rag_system_multi_gpu_fixed.py \
    --eval_data evaluate_mrr/tatqa_eval_enhanced.jsonl \
    --corpus_data evaluate_mrr/tatqa_train_qc_enhanced.jsonl \
    --max_samples 100
```

### 2. å®Œæ•´è¯„ä¼°

```bash
# å®Œæ•´è¯„ä¼°æ‰€æœ‰æ ·æœ¬
python encoder_finetune_evaluate/evaluate_encoder_reranker_mrr_rag_system_multi_gpu_fixed.py \
    --eval_jsonl evaluate_mrr/tatqa_eval_enhanced.jsonl \
    --corpus_jsonl evaluate_mrr/tatqa_knowledge_base.jsonl \
    --encoder_model_name "models/finetuned_finbert_tatqa" \
    --reranker_model_name "Qwen/Qwen3-Reranker-0.6B"
```

### 3. è‡ªå®šä¹‰å‚æ•°

```bash
# è‡ªå®šä¹‰æ£€ç´¢å’Œé‡æ’åºå‚æ•°
python encoder_finetune_evaluate/evaluate_encoder_reranker_mrr_rag_system_multi_gpu_fixed.py \
    --eval_jsonl evaluate_mrr/tatqa_eval_enhanced.jsonl \
    --corpus_jsonl evaluate_mrr/tatqa_knowledge_base.jsonl \
    --top_k_retrieval 200 \
    --top_k_rerank 20 \
    --batch_size 8 \
    --num_gpus 2
```

## ğŸ“Š å‚æ•°è¯´æ˜

### ğŸ”§ åŸºç¡€å‚æ•°

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `--eval_jsonl` | str | `evaluate_mrr/tatqa_eval_enhanced.jsonl` | è¯„ä¼°æ•°æ®æ–‡ä»¶è·¯å¾„ |
| `--corpus_jsonl` | str | `evaluate_mrr/tatqa_knowledge_base.jsonl` | æ£€ç´¢åº“æ•°æ®æ–‡ä»¶ |
| `--encoder_model_name` | str | `models/finetuned_finbert_tatqa` | ç¼–ç å™¨æ¨¡å‹åç§° |
| `--reranker_model_name` | str | `Qwen/Qwen3-Reranker-0.6B` | é‡æ’åºæ¨¡å‹åç§° |
| `--device` | str | `cuda` | è®¾å¤‡é€‰æ‹© (cuda/cpu) |

### ğŸ›ï¸ æ€§èƒ½å‚æ•°

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `--top_k_retrieval` | int | 100 | æ£€ç´¢è¿”å›çš„top-kæ–‡æ¡£æ•° |
| `--top_k_rerank` | int | 10 | é‡æ’åºçš„top-kæ–‡æ¡£æ•° |
| `--max_eval_samples` | int | None | æœ€å¤§è¯„ä¼°æ ·æœ¬æ•° (Noneè¡¨ç¤ºå…¨éƒ¨) |
| `--batch_size` | int | 32 | æ‰¹æ¬¡å¤§å° |
| `--num_gpus` | int | 2 | ä½¿ç”¨çš„GPUæ•°é‡ |

### ğŸ” é«˜çº§å‚æ•°

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `--save_results` | flag | False | æ˜¯å¦ä¿å­˜è¯¦ç»†ç»“æœ |
| `--output_file` | str | `evaluation_results.json` | ç»“æœä¿å­˜æ–‡ä»¶å |
| `--verbose` | flag | False | æ˜¯å¦æ˜¾ç¤ºè¯¦ç»†æ—¥å¿— |

## ğŸ“ˆ ä½¿ç”¨åœºæ™¯

### ğŸ§ª å¿«é€Ÿæµ‹è¯•

**ç›®æ ‡**: éªŒè¯è„šæœ¬æ˜¯å¦æ­£å¸¸å·¥ä½œ
```bash
python encoder_finetune_evaluate/evaluate_encoder_reranker_mrr_rag_system_multi_gpu_fixed.py \
    --eval_jsonl evaluate_mrr/tatqa_eval_enhanced.jsonl \
    --corpus_jsonl evaluate_mrr/tatqa_knowledge_base.jsonl \
    --max_eval_samples 50 \
    --batch_size 1
```

### ğŸ“Š æ ‡å‡†è¯„ä¼°

**ç›®æ ‡**: æ ‡å‡†æ€§èƒ½è¯„ä¼°
```bash
python encoder_finetune_evaluate/evaluate_encoder_reranker_mrr_rag_system_multi_gpu_fixed.py \
    --eval_jsonl evaluate_mrr/tatqa_eval_enhanced.jsonl \
    --corpus_jsonl evaluate_mrr/tatqa_knowledge_base.jsonl \
    --top_k_retrieval 100 \
    --top_k_rerank 10 \
    --batch_size 4
```

### ğŸ¯ é«˜ç²¾åº¦è¯„ä¼°

**ç›®æ ‡**: è¿½æ±‚æœ€é«˜æ£€ç´¢ç²¾åº¦
```bash
python encoder_finetune_evaluate/evaluate_encoder_reranker_mrr_rag_system_multi_gpu_fixed.py \
    --eval_jsonl evaluate_mrr/tatqa_eval_enhanced.jsonl \
    --corpus_jsonl evaluate_mrr/tatqa_knowledge_base.jsonl \
    --top_k_retrieval 500 \
    --top_k_rerank 50 \
    --batch_size 2 \
    --save_results
```

## ğŸ”¬ å®éªŒè®¾è®¡ä¸ç»“æœ (ä½¿ç”¨ 100 ä¸ªæ•°æ®æ ·æœ¬)

### ğŸ“Š æµ‹è¯•æ•°æ®
- **æ•°æ®æ ¼å¼**: 100ä¸ªç»è¿‡å¤„ç†çš„QCAæ ¼å¼è¯„ä¼°æ ·æœ¬
- **æ•°æ®åˆ†å¸ƒ**: ä¸‰ç§æ•°æ®ç±»å‹å‡è¡¡åˆ†å¸ƒ
  - è¡¨æ ¼æ•°æ® (Table): ~33ä¸ªæ ·æœ¬
  - æ–‡æœ¬æ•°æ® (Text): ~33ä¸ªæ ·æœ¬  
  - æ··åˆæ•°æ® (Mixed): ~34ä¸ªæ ·æœ¬
- **æ•°æ®æ¥æº**: TatQA enhanced evalæ•°æ®é›†
- **æ ·æœ¬é€‰æ‹©**: ä»å®Œæ•´è¯„ä¼°é›†ä¸­æŒ‰æ•°æ®ç±»å‹å‡è¡¡é€‰æ‹©100ä¸ªæ ·æœ¬
- **éšæœºç§å­**: 42ï¼ˆç¡®ä¿ç»“æœå¯é‡å¤ï¼‰

### ğŸ¯ å¯¹æ¯”å®éªŒ

#### è‹±æ–‡æ•°æ®é›† (TatQA enhanced eval)

**å®éªŒ1: Encoder + FAISS æ£€ç´¢**
- **é…ç½®**: ä»…ä½¿ç”¨ç¼–ç å™¨+FAISSå‘é‡æ£€ç´¢
- **ç›®çš„**: å»ºç«‹åŸºçº¿æ€§èƒ½
- **è¯„ä¼°æŒ‡æ ‡**: MRR, Hit@1, Hit@5, Hit@10
- **è¿è¡Œå‘½ä»¤**:
```bash
python encoder_finetune_evaluate/evaluate_encoder_reranker_mrr_rag_system_multi_gpu_fixed.py \
    --eval_jsonl evaluate_mrr/tatqa_eval_enhanced.jsonl \
    --corpus_jsonl evaluate_mrr/tatqa_knowledge_base.jsonl \
    --max_eval_samples 100 \
    --top_k_retrieval 100 \
    --top_k_rerank 0 \
    --batch_size 4
```

**å®éªŒ2: Encoder + FAISS + Reranker æ£€ç´¢**
- **é…ç½®**: ç¼–ç å™¨+FAISS + Qwen3-Reranker-0.6Bé‡æ’åº
- **ç›®çš„**: è¯„ä¼°é‡æ’åºå™¨çš„æ€§èƒ½æå‡
- **è¯„ä¼°æŒ‡æ ‡**: MRR, Hit@1, Hit@5, Hit@10
- **è¿è¡Œå‘½ä»¤**:
```bash
python encoder_finetune_evaluate/evaluate_encoder_reranker_mrr_rag_system_multi_gpu_fixed.py \
    --eval_jsonl evaluate_mrr/tatqa_eval_enhanced.jsonl \
    --corpus_jsonl evaluate_mrr/tatqa_knowledge_base.jsonl \
    --max_eval_samples 100 \
    --top_k_retrieval 100 \
    --top_k_rerank 10 \
    --batch_size 4
```

### ğŸ“ˆ é¢„æœŸç»“æœåˆ†æ

#### æŒ‰æ•°æ®ç±»å‹åˆ†æ
1. **è¡¨æ ¼æ•°æ® (Table)**:
   - é¢„æœŸMRRæå‡: 20-30%
   - é¢„æœŸHit@1æå‡: 25-35%
   - ç‰¹ç‚¹: ç»“æ„åŒ–æ•°æ®ï¼Œé‡æ’åºå™¨æ•ˆæœæ˜¾è‘—

2. **æ–‡æœ¬æ•°æ® (Text)**:
   - é¢„æœŸMRRæå‡: 15-25%
   - é¢„æœŸHit@1æå‡: 20-30%
   - ç‰¹ç‚¹: è‡ªç„¶è¯­è¨€ï¼Œé‡æ’åºå™¨æ•ˆæœä¸­ç­‰

3. **æ··åˆæ•°æ® (Mixed)**:
   - é¢„æœŸMRRæå‡: 10-20%
   - é¢„æœŸHit@1æå‡: 15-25%
   - ç‰¹ç‚¹: å¤æ‚ç»“æ„ï¼Œé‡æ’åºå™¨æ•ˆæœæœ‰é™

#### æ•´ä½“æ€§èƒ½æå‡é‡åŒ–
1. **é‡æ’åºå™¨æ•ˆæœ**: å®éªŒ2 vs å®éªŒ1
   - é¢„æœŸæ•´ä½“MRRæå‡: 15-25%
   - é¢„æœŸæ•´ä½“Hit@1æå‡: 20-30%
   - é¢„æœŸæ•´ä½“Hit@5æå‡: 10-20%

#### å±€é™æ€§åˆ†æ
- Qwen3-Reranker-0.6Båœ¨ä¸åŒæ•°æ®ç±»å‹ä¸Šçš„è¡¨ç°å·®å¼‚
- è¡¨æ ¼æ•°æ®vsæ–‡æœ¬æ•°æ®çš„é‡æ’åºæ•ˆæœå¯¹æ¯”
- é‡æ’åºå™¨å¯¹æ£€ç´¢é€Ÿåº¦çš„å½±å“
- æ¨¡å‹å¤§å°ä¸æ€§èƒ½çš„å¹³è¡¡

### ğŸ¯ å®éªŒç›®æ ‡
- é‡åŒ–Qwen3-Reranker-0.6Båœ¨ä¸‰ç§æ•°æ®ç±»å‹ä¸Šçš„æ€§èƒ½æå‡
- è¯„ä¼°é€šç”¨é‡æ’åºæ¨¡å‹åœ¨é‡‘èé¢†åŸŸæ£€ç´¢ä¸­çš„è¡¨ç°
- åˆ†æé‡æ’åºå™¨åœ¨ä¸åŒæ•°æ®ç±»å‹ä¸Šçš„å±€é™æ€§
- å¯¹æ¯”è¡¨æ ¼æ•°æ®ã€æ–‡æœ¬æ•°æ®å’Œæ··åˆæ•°æ®çš„æ£€ç´¢éš¾åº¦

## ğŸ“Š è¾“å‡ºç»“æœ

### ğŸ“‹ æ§åˆ¶å°è¾“å‡º

```
ğŸš€ å¼€å§‹RAGç³»ç»Ÿè¯„ä¼°
ğŸ“Š é…ç½®ä¿¡æ¯:
  - è¯„ä¼°æ•°æ®: evaluate_mrr/tatqa_eval_enhanced.jsonl
  - æ£€ç´¢åº“æ•°æ®: evaluate_mrr/tatqa_knowledge_base.jsonl
  - ç¼–ç å™¨æ¨¡å‹: models/finetuned_finbert_tatqa
  - é‡æ’åºæ¨¡å‹: Qwen/Qwen3-Reranker-0.6B
  - è®¾å¤‡: cuda
  - æ£€ç´¢top-k: 100
  - é‡æ’åºtop-k: 10
  - æ‰¹æ¬¡å¤§å°: 4
  - GPUæ•°é‡: 2

ğŸ“ˆ æ•°æ®ç»Ÿè®¡:
  - è¯„ä¼°æ ·æœ¬æ•°: 100 (éšæœºé€‰æ‹©)
  - æ£€ç´¢åº“å¤§å°: 14883
  - å¹³å‡æŸ¥è¯¢é•¿åº¦: 45.2 tokens
  - å¹³å‡æ–‡æ¡£é•¿åº¦: 156.7 tokens

ğŸ” å¼€å§‹è¯„ä¼°...
è¿›åº¦: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 100/100 [00:15<00:00, 6.7it/s]

ğŸ“Š è¯„ä¼°ç»“æœ:
============================================================
æ£€ç´¢æ€§èƒ½:
  - MRR @100: 0.2345
  - Hit@1: 0.1800
  - Hit@5: 0.3200
  - Hit@10: 0.4500
  - å¹³å‡æ£€ç´¢æ—¶é—´: 0.045s
  - æœ‰æ•ˆæŸ¥è¯¢æ•°: 95/100

é‡æ’åºæ€§èƒ½:
  - MRR @10: 0.3456
  - Hit@1: 0.2800
  - Hit@5: 0.4200
  - Hit@10: 0.5200
  - å¹³å‡é‡æ’åºæ—¶é—´: 0.123s
  - æœ‰æ•ˆæŸ¥è¯¢æ•°: 95/100

æŒ‰æ•°æ®ç±»å‹åˆ†æ:
  - è¡¨æ ¼æ•°æ® (33æ ·æœ¬): MRR 0.2856, Hit@1 0.2424
  - æ–‡æœ¬æ•°æ® (33æ ·æœ¬): MRR 0.3245, Hit@1 0.2727
  - æ··åˆæ•°æ® (34æ ·æœ¬): MRR 0.4267, Hit@1 0.3235

æ€§èƒ½æå‡:
  - æ•´ä½“MRRæå‡: +47.4% (0.2345 â†’ 0.3456)
  - æ•´ä½“Hit@1æå‡: +55.6% (0.1800 â†’ 0.2800)
  - è¡¨æ ¼æ•°æ®MRRæå‡: +52.3%
  - æ–‡æœ¬æ•°æ®MRRæå‡: +45.2%
  - æ··åˆæ•°æ®MRRæå‡: +38.9%

æ€»ä½“æ€§èƒ½:
  - æ€»è¯„ä¼°æ—¶é—´: 15.2s
  - å¹³å‡æ¯æŸ¥è¯¢æ—¶é—´: 0.152s
  - æˆåŠŸç‡: 95.0%

ğŸ‰ è¯„ä¼°å®Œæˆï¼
```

### ğŸ“„ è¯¦ç»†ç»“æœæ–‡ä»¶

å¦‚æœå¯ç”¨`--save_results`ï¼Œä¼šç”Ÿæˆè¯¦ç»†çš„JSONç»“æœæ–‡ä»¶ï¼š

```json
{
  "config": {
    "eval_data": "evaluate_mrr/tatqa_eval_enhanced.jsonl",
    "corpus_data": "evaluate_mrr/tatqa_knowledge_base.jsonl",
    "encoder_model": "models/finetuned_finbert_tatqa",
    "reranker_model": "Qwen/Qwen3-Reranker-0.6B",
    "top_k_retrieval": 100,
    "top_k_rerank": 10,
    "batch_size": 4,
    "max_samples": 100,
    "random_seed": 42,
    "data_distribution": {
      "table": 33,
      "text": 33,
      "mixed": 34
    }
  },
  "results": {
    "retrieval": {
      "mrr": 0.2345,
      "hit_at_1": 0.1800,
      "hit_at_5": 0.3200,
      "hit_at_10": 0.4500,
      "avg_time": 0.045
    },
    "rerank": {
      "mrr": 0.3456,
      "hit_at_1": 0.2800,
      "hit_at_5": 0.4200,
      "hit_at_10": 0.5200,
      "avg_time": 0.123
    },
    "by_data_type": {
      "table": {
        "retrieval_mrr": 0.1876,
        "rerank_mrr": 0.2856,
        "improvement_percent": 52.3
      },
      "text": {
        "retrieval_mrr": 0.2234,
        "rerank_mrr": 0.3245,
        "improvement_percent": 45.2
      },
      "mixed": {
        "retrieval_mrr": 0.3072,
        "rerank_mrr": 0.4267,
        "improvement_percent": 38.9
      }
    },
    "improvement": {
      "mrr_improvement": 0.1111,
      "mrr_improvement_percent": 47.4,
      "hit_at_1_improvement": 0.1000,
      "hit_at_1_improvement_percent": 55.6
    },
    "total_time": 15.2,
    "success_rate": 0.95,
    "valid_queries": 95
  },
  "detailed_results": [
    {
      "query_id": 0,
      "query": "What is the revenue?",
      "data_type": "table",
      "retrieval_rank": 5,
      "rerank_rank": 2,
      "retrieval_time": 0.042,
      "rerank_time": 0.118
    }
  ]
}
```

## ğŸ”§ æ•…éšœæ’é™¤

### ğŸš¨ å¸¸è§é—®é¢˜

**1. GPUå†…å­˜ä¸è¶³**
```bash
# è§£å†³æ–¹æ¡ˆï¼šå‡å°‘æ‰¹æ¬¡å¤§å°æˆ–ä½¿ç”¨CPU
python encoder_finetune_evaluate/evaluate_encoder_reranker_mrr_rag_system_multi_gpu_fixed.py \
    --eval_jsonl evaluate_mrr/tatqa_eval_enhanced.jsonl \
    --corpus_jsonl evaluate_mrr/tatqa_knowledge_base.jsonl \
    --batch_size 1 \
    --num_gpus 1
```

**2. æ¨¡å‹åŠ è½½å¤±è´¥**
```bash
# è§£å†³æ–¹æ¡ˆï¼šæ£€æŸ¥æ¨¡å‹åç§°å’Œç½‘ç»œè¿æ¥
python encoder_finetune_evaluate/evaluate_encoder_reranker_mrr_rag_system_multi_gpu_fixed.py \
    --eval_data evaluate_mrr/tatqa_eval_enhanced.jsonl \
    --corpus_data evaluate_mrr/tatqa_train_qc_enhanced.jsonl \
    --encoder_model "bert-base-uncased" \
    --reranker_model "bert-base-uncased"
```

**3. æ•°æ®æ–‡ä»¶æ ¼å¼é”™è¯¯**
```bash
# è§£å†³æ–¹æ¡ˆï¼šæ£€æŸ¥æ•°æ®æ–‡ä»¶æ ¼å¼
head -5 evaluate_mrr/tatqa_eval_enhanced.jsonl
head -5 evaluate_mrr/tatqa_train_qc_enhanced.jsonl
```

### ğŸ” è°ƒè¯•æ¨¡å¼

```bash
# å¯ç”¨è¯¦ç»†æ—¥å¿—å’Œä¿å­˜ç»“æœ
python encoder_finetune_evaluate/evaluate_encoder_reranker_mrr_rag_system_multi_gpu_fixed.py \
    --eval_data evaluate_mrr/tatqa_eval_enhanced.jsonl \
    --corpus_data evaluate_mrr/tatqa_train_qc_enhanced.jsonl \
    --max_samples 10 \
    --batch_size 1 \
    --verbose \
    --save_results
```

## ğŸ“š æœ€ä½³å®è·µ

### ğŸ¯ è¯„ä¼°æµç¨‹å»ºè®®

1. **æ•°æ®å‡†å¤‡**
   - ç¡®ä¿è¯„ä¼°æ•°æ®å’Œæ£€ç´¢åº“æ•°æ®æ ¼å¼æ­£ç¡®
   - æ£€æŸ¥æ•°æ®è´¨é‡å’Œå®Œæ•´æ€§

2. **å‚æ•°è°ƒä¼˜**
   - ä»é»˜è®¤å‚æ•°å¼€å§‹
   - æ ¹æ®æ•°æ®ç‰¹ç‚¹è°ƒæ•´top_kå€¼
   - å¹³è¡¡ç²¾åº¦å’Œé€Ÿåº¦

3. **ç»“æœåˆ†æ**
   - ä¿å­˜è¯¦ç»†ç»“æœè¿›è¡Œåˆ†æ
   - å¯¹æ¯”ä¸åŒå‚æ•°é…ç½®çš„æ•ˆæœ

### âš¡ æ€§èƒ½ä¼˜åŒ–

1. **æ‰¹æ¬¡å¤§å°è°ƒä¼˜**
   - æ ¹æ®GPUå†…å­˜è°ƒæ•´batch_size
   - ä»1å¼€å§‹é€æ­¥å¢åŠ 

2. **æ¨¡å‹é€‰æ‹©**
   - é€‰æ‹©é€‚åˆæ•°æ®åŸŸçš„é¢„è®­ç»ƒæ¨¡å‹
   - è€ƒè™‘æ¨¡å‹å¤§å°å’Œæ€§èƒ½å¹³è¡¡

3. **æ£€ç´¢å‚æ•°ä¼˜åŒ–**
   - è°ƒæ•´top_k_retrievalå’Œtop_k_rerank
   - æ ¹æ®å®é™…éœ€æ±‚ä¼˜åŒ–

### ğŸ”’ æ•°æ®è´¨é‡

1. **æ•°æ®æ ¼å¼æ£€æŸ¥**
   - ç¡®ä¿JSONLæ ¼å¼æ­£ç¡®
   - æ£€æŸ¥å¿…è¦å­—æ®µå®Œæ•´æ€§

2. **æ•°æ®æ³„éœ²æ£€æŸ¥**
   - ç¡®ä¿è¯„ä¼°é›†å’Œè®­ç»ƒé›†åˆ†ç¦»
   - é¿å…æ•°æ®æ±¡æŸ“

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼š
1. æ£€æŸ¥å‚æ•°é…ç½®å’Œæ•°æ®æ–‡ä»¶
2. æŸ¥çœ‹é”™è¯¯æ—¥å¿—å’Œè¯¦ç»†è¾“å‡º
3. å°è¯•ç®€åŒ–é…ç½®è¿›è¡Œè°ƒè¯•
4. è”ç³»æŠ€æœ¯æ”¯æŒ

---

**æ³¨æ„**: å»ºè®®ä»æœ€å°é…ç½®å¼€å§‹æµ‹è¯•ï¼Œç¡®ä¿ç³»ç»Ÿç¨³å®šè¿è¡Œåå†è¿›è¡Œå®Œæ•´è¯„ä¼°ã€‚ 