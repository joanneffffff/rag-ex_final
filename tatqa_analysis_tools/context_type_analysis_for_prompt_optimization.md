# TAT-QA Context类型分析报告 - Prompt模板优化指南

## 📊 Context类型分布概览

### 总体分布（16,561个样本）
- **table-text（表格+文本混合）**: 12,137 (73.3%)
- **text（纯文本）**: 3,903 (23.6%)
- **table（纯表格）**: 521 (3.1%)

### 各数据集分布

#### 训练集（14,883样本）
- **table-text**: 10,946 (73.5%)
- **text**: 3,514 (23.6%)
- **table**: 423 (2.8%)

#### 评估集（1,663样本）
- **table-text**: 1,186 (71.3%)
- **text**: 381 (22.9%)
- **table**: 96 (5.8%)

#### 测试集（15样本）
- **text**: 8 (53.3%)
- **table-text**: 5 (33.3%)
- **table**: 2 (13.3%)

## 🔍 Context类型与Answer_from关系分析

### 关键发现

#### 1. Context类型 vs Answer_from映射
- **Context类型 'table-text'** (73.3%):
  - answer_from='table': 6,419个 (52.9%)
  - answer_from='table-text': 4,527个 (37.3%)
  - 说明：大部分context包含表格和文本，但答案主要来自表格

- **Context类型 'text'** (23.6%):
  - answer_from='text': 3,903个 (100%)
  - 说明：纯文本context的答案完全来自文本

- **Context类型 'table'** (3.1%):
  - answer_from='table': 273个 (52.4%)
  - answer_from='table-text': 150个 (28.8%)
  - 说明：纯表格context也可能需要结合文本信息

#### 2. 重要观察
- **73.3%的context包含表格和文本混合内容**
- **只有3.1%的context是纯表格**
- **23.6%的context是纯文本**
- **大部分答案（52.9%）来自表格，即使context包含文本**

## 🎯 Prompt模板优化建议

### 1. 主要Context类型：table-text (73.3%)

#### 建议的Prompt结构：
```
你是一个专业的财务数据分析助手。请基于以下信息回答问题：

[表格信息]
{表格内容}

[相关文本说明]
{文本内容}

问题：{query}

请仔细分析表格数据和文本说明，然后回答问题。如果答案需要计算，请提供计算过程。
```

#### 优化要点：
- **明确区分表格和文本部分**
- **强调需要同时理解两种信息源**
- **提供计算指导**

### 2. 次要Context类型：text (23.6%)

#### 建议的Prompt结构：
```
你是一个专业的财务文档分析助手。请基于以下文本信息回答问题：

[文档内容]
{文本内容}

问题：{query}

请仔细阅读文本内容，提取相关信息回答问题。
```

#### 优化要点：
- **简化结构，专注于文本理解**
- **强调信息提取能力**

### 3. 最少Context类型：table (3.1%)

#### 建议的Prompt结构：
```
你是一个专业的表格数据分析助手。请基于以下表格数据回答问题：

[表格数据]
{表格内容}

问题：{query}

请仔细分析表格数据，进行必要的计算后回答问题。
```

#### 优化要点：
- **专注于表格数据分析**
- **强调计算能力**

## 🚀 动态Prompt策略

### 基于Context类型的自适应Prompt

```python
def generate_adaptive_prompt(context, query):
    context_type = determine_context_type(context)
    
    if context_type == "table-text":
        return f"""
你是一个专业的财务数据分析助手。请基于以下混合信息回答问题：

[表格数据]
{extract_table_content(context)}

[相关说明]
{extract_text_content(context)}

问题：{query}

请同时考虑表格数据和文本说明，如果需要进行计算，请提供计算过程。
"""
    
    elif context_type == "text":
        return f"""
你是一个专业的财务文档分析助手。请基于以下文本信息回答问题：

[文档内容]
{context}

问题：{query}

请仔细阅读文本内容，提取相关信息回答问题。
"""
    
    else:  # table
        return f"""
你是一个专业的表格数据分析助手。请基于以下表格数据回答问题：

[表格数据]
{context}

问题：{query}

请仔细分析表格数据，进行必要的计算后回答问题。
"""
```

## 📈 性能优化建议

### 1. 针对主要类型（table-text）的优化
- **训练重点**: 73.3%的样本需要同时理解表格和文本
- **模型能力**: 需要强大的多模态理解能力
- **提示词**: 明确指导模型如何结合两种信息源

### 2. 针对次要类型（text）的优化
- **训练重点**: 23.6%的样本需要文本理解
- **模型能力**: 需要良好的文本信息提取能力
- **提示词**: 简化结构，专注于文本分析

### 3. 针对最少类型（table）的优化
- **训练重点**: 3.1%的样本需要表格计算
- **模型能力**: 需要数学计算和表格理解能力
- **提示词**: 强调计算过程和准确性

## 🎯 结论与建议

### 1. Prompt模板优先级
1. **优先优化table-text类型** (73.3%) - 影响最大
2. **其次优化text类型** (23.6%) - 影响中等
3. **最后优化table类型** (3.1%) - 影响最小

### 2. 关键优化策略
- **动态Prompt**: 根据context类型自动调整prompt结构
- **明确指导**: 为每种类型提供具体的分析指导
- **计算支持**: 特别关注需要计算的table-text类型

### 3. 预期效果
- **table-text类型**: 提高73.3%样本的准确性
- **整体性能**: 通过针对性优化提升整体表现
- **用户体验**: 更准确的答案和更好的解释

这个分析为TAT-QA数据集的prompt模板优化提供了数据驱动的指导。 