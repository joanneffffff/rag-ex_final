# 中文查询Prompt模板详解

## 模板文件位置
- **文件路径**: `data/prompt_templates/multi_stage_chinese_template.txt`
- **加载器**: `xlm/components/prompt_templates/template_loader.py`
- **使用场景**: 多阶段检索系统的中文查询处理

## 原始模板内容

```txt
基于以下上下文信息，回答用户的问题。

**极度重要：你的输出必须是纯粹、直接的回答，不包含任何自我反思、思考过程、对Prompt的分析、与回答无关的额外注释、任何格式标记（如 boxed、数字列表、加粗）、或任何形式的元评论。请勿引用或复述Prompt内容。你的回答必须直接、简洁地结束，不带任何引导语或后续说明。**

上下文：{context}

问题：{query}

回答： 
```

## 模板参数

| 参数 | 类型 | 说明 | 示例 |
|------|------|------|------|
| `{context}` | str | 检索到的相关上下文信息 | 德赛电池（000049）的业绩预告超出预期... |
| `{query}` | str | 用户的原始查询问题 | 德赛电池（000049）2021年利润持续增长的主要原因是什么？ |

## 模板特点

### 1. 严格的输出要求
- **纯粹直接**: 要求输出纯粹、直接的回答
- **禁止反思**: 不包含任何自我反思或思考过程
- **禁止分析**: 不对Prompt进行分析
- **禁止注释**: 不包含与回答无关的额外注释

### 2. 格式限制
- **禁止格式标记**: 不使用boxed、数字列表、加粗等格式
- **禁止元评论**: 不包含任何形式的元评论
- **禁止引用**: 不引用或复述Prompt内容

### 3. 结构要求
- **简洁结束**: 回答必须直接、简洁地结束
- **无引导语**: 不带任何引导语或后续说明
- **清晰结构**: 上下文 → 问题 → 回答

## 使用流程

### 1. 模板加载
```python
from xlm.components.prompt_templates.template_loader import template_loader

# 获取模板
template = template_loader.get_template("multi_stage_chinese_template")
```

### 2. 模板格式化
```python
# 格式化模板
formatted_prompt = template_loader.format_template(
    "multi_stage_chinese_template",
    context=context,
    query=query
)
```

### 3. 在多阶段检索中的使用
```python
# 在MultiStageRetrievalSystem.generate_answer()中
if self.dataset_type == "chinese":
    prompt = template_loader.format_template(
        "multi_stage_chinese_template",
        context=context, 
        query=query
    )
```

## 实际使用示例

### 输入
- **上下文**: 德赛电池（000049）的业绩预告超出预期，主要得益于iPhone 12 Pro Max需求强劲和新品盈利能力提升...
- **查询**: 德赛电池（000049）2021年利润持续增长的主要原因是什么？

### 格式化后的Prompt
```
基于以下上下文信息，回答用户的问题。

**极度重要：你的输出必须是纯粹、直接的回答，不包含任何自我反思、思考过程、对Prompt的分析、与回答无关的额外注释、任何格式标记（如 boxed、数字列表、加粗）、或任何形式的元评论。请勿引用或复述Prompt内容。你的回答必须直接、简洁地结束，不带任何引导语或后续说明。**

上下文：
    德赛电池（000049）的业绩预告超出预期，主要得益于iPhone 12 Pro Max需求强劲和新品盈利能力提升。
    预计2021年利润将持续增长，源于A客户的业务成长、非手机业务的增长以及并表比例的增加。
    尽管安卓业务受到H客户销量下滑的影响，但新荣耀新品的发布预计将缓解这一影响。

问题：德赛电池（000049）2021年利润持续增长的主要原因是什么？

回答：
```

## 设计理念

### 1. 简洁性
- 避免冗长的思考过程
- 直接给出答案要点
- 减少不必要的解释

### 2. 准确性
- 基于上下文信息回答
- 避免主观臆测
- 保持客观中立

### 3. 一致性
- 统一的回答格式
- 可预测的输出结构
- 便于后续处理

## 与其他模板的区别

| 特性 | 中文模板 | 英文模板 |
|------|----------|----------|
| 语言 | 中文 | 英文 |
| 严格程度 | 极高 | 中等 |
| 格式限制 | 严格禁止 | 相对宽松 |
| 输出要求 | 纯粹直接 | 详细解释 |

## 优化建议

1. **上下文长度控制**: 确保context不超过模型的最大输入长度
2. **问题清晰度**: 确保query表达清晰明确
3. **模板一致性**: 保持与其他模板的风格一致
4. **错误处理**: 添加模板加载失败的回退机制 