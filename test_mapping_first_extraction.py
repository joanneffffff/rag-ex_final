#!/usr/bin/env python3
"""
æµ‹è¯•æ˜ å°„ä¼˜å…ˆçš„å…¬å¸ä¿¡æ¯æå–å‡½æ•°
"""

from xlm.utils.stock_info_extractor import extract_stock_info_with_mapping, extract_stock_info

def test_mapping_first_extraction():
    """æµ‹è¯•æ˜ å°„ä¼˜å…ˆçš„æå–å‡½æ•°"""
    
    test_queries = [
        # æµ‹è¯•ç”¨ä¾‹1: æ˜ å°„æ–‡ä»¶ä¸­å­˜åœ¨çš„å…¬å¸
        "ä¸­å…´é€šè®¯åœ¨AIæ—¶ä»£å¦‚ä½•å¸ƒå±€é€šä¿¡èƒ½åŠ›æå‡ï¼Œä»¥åŠå…¶å¯¹å…¬å¸æœªæ¥ä¸šç»©çš„å½±å“æ˜¯ä»€ä¹ˆï¼Ÿ",
        "ä¸­å…´é€šè®¯ï¼ˆ000063ï¼‰åœ¨AIæ—¶ä»£å¦‚ä½•å¸ƒå±€é€šä¿¡èƒ½åŠ›æå‡ï¼Ÿ",
        "ä¸­å…´é€šè®¯(000063)åœ¨AIæ—¶ä»£å¦‚ä½•å¸ƒå±€é€šä¿¡èƒ½åŠ›æå‡ï¼Ÿ",
        "ä¸­å…´é€šè®¯000063åœ¨AIæ—¶ä»£å¦‚ä½•å¸ƒå±€é€šä¿¡èƒ½åŠ›æå‡ï¼Ÿ",
        
        # æµ‹è¯•ç”¨ä¾‹2: æ˜ å°„æ–‡ä»¶ä¸­å­˜åœ¨çš„å…¬å¸
        "æ—æ´‹èƒ½æºï¼ˆ601222ï¼‰åœ¨2020å¹´ä¸ŠåŠå¹´ä¸šç»©è¡¨ç°å¦‚ä½•ï¼Ÿ",
        "æ—æ´‹èƒ½æºåœ¨2020å¹´ä¸ŠåŠå¹´ä¸šç»©è¡¨ç°å¦‚ä½•ï¼Ÿ",
        
        # æµ‹è¯•ç”¨ä¾‹3: æ˜ å°„æ–‡ä»¶ä¸­å­˜åœ¨çš„å…¬å¸
        "å®è±ç‰¹ï¼ˆ300246ï¼‰çš„è´¢åŠ¡çŠ¶å†µå¦‚ä½•ï¼Ÿ",
        "å®è±ç‰¹çš„è´¢åŠ¡çŠ¶å†µå¦‚ä½•ï¼Ÿ",
        
        # æµ‹è¯•ç”¨ä¾‹4: ä¸å­˜åœ¨çš„å…¬å¸ï¼ˆåº”è¯¥è¢«è¿‡æ»¤æ‰ï¼‰
        "ä»¥åŠå…¶å¯¹å…¬å¸æœªæ¥ä¸šç»©çš„å½±å“æ˜¯ä»€ä¹ˆï¼Ÿ",
        "è¿™ä¸ªå…¬å¸çš„è¡¨ç°å¦‚ä½•ï¼Ÿ",
        
        # æµ‹è¯•ç”¨ä¾‹5: æ˜ å°„æ–‡ä»¶ä¸­å­˜åœ¨çš„å…¬å¸
        "æµ·èç§‘æŠ€ï¼ˆ300915ï¼‰çš„å‘å±•å‰æ™¯å¦‚ä½•ï¼Ÿ",
        "æµ·èç§‘æŠ€çš„å‘å±•å‰æ™¯å¦‚ä½•ï¼Ÿ",
    ]
    
    print("=" * 80)
    print("æ˜ å°„ä¼˜å…ˆçš„å…¬å¸ä¿¡æ¯æå–æµ‹è¯•")
    print("=" * 80)
    
    for i, query in enumerate(test_queries, 1):
        print(f"\n{i}. æŸ¥è¯¢: {query}")
        print("   " + "-" * 60)
        
        # ä½¿ç”¨æ–°çš„æ˜ å°„ä¼˜å…ˆå‡½æ•°
        print("   ã€æ˜ å°„ä¼˜å…ˆæå–ã€‘:")
        company_name, stock_code = extract_stock_info_with_mapping(query)
        
        if company_name:
            print(f"   âœ… å…¬å¸åç§°: {company_name}")
        else:
            print(f"   âŒ æœªæå–åˆ°å…¬å¸åç§°")
            
        if stock_code:
            print(f"   âœ… è‚¡ç¥¨ä»£ç : {stock_code}")
        else:
            print(f"   âŒ æœªæå–åˆ°è‚¡ç¥¨ä»£ç ")
        
        # ä½¿ç”¨åŸæ¥çš„å‡½æ•°ä½œä¸ºå¯¹æ¯”
        print("   ã€åŸå‡½æ•°å¯¹æ¯”ã€‘:")
        old_company_name, old_stock_code = extract_stock_info(query)
        
        if old_company_name:
            print(f"   âœ… å…¬å¸åç§°: {old_company_name}")
        else:
            print(f"   âŒ æœªæå–åˆ°å…¬å¸åç§°")
            
        if old_stock_code:
            print(f"   âœ… è‚¡ç¥¨ä»£ç : {old_stock_code}")
        else:
            print(f"   âŒ æœªæå–åˆ°è‚¡ç¥¨ä»£ç ")
        
        # æ¯”è¾ƒç»“æœ
        if company_name != old_company_name or stock_code != old_stock_code:
            print("   ğŸ”„ ç»“æœä¸åŒï¼")
        else:
            print("   âœ… ç»“æœä¸€è‡´")

if __name__ == "__main__":
    test_mapping_first_extraction() 